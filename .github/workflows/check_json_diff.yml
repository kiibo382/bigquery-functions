name: Check JSON diff

on:
  schedule:
    - cron: '00 0 * * *'
permissions:
  contents: write
  pull-requests: write


jobs:
  check:
    name: Check
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout sources
        uses: actions/checkout@v2

      - name: Install stable toolchain
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true

      - uses: Swatinem/rust-cache@v1

      - name: Build
        run: cargo build --verbose
      - name: Run
        run: CARGO_RUN_OUTPUT=$(cargo run) >> $GITHUB_ENV
      - name: Create commits
        if : ${{ env.CARGO_RUN_OUTPUT == "differ" }}
        run: |
          git config user.name '${{ github.actor }}'
          git config user.email '${{ github.actor }}@users.noreply.github.com'
          git add -A
          git commit -m "Update Json files"
      - name: Create Pull Request
        if : ${{ env.CARGO_RUN_OUTPUT == "differ" }}
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update Json files
          title: Update Json files
          body: Update Json files
          branch: update-json-files
          base: main
          reviewers: |
            ${{ github.actor }}
          assignees: |
            ${{ github.actor }}
